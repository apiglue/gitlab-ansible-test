default:
  image:
    name: alpine/ansible
    entrypoint: [""]
  timeout: 15 minutes
  tags:
    - ansible

stages:
  - ansible-check-a
  - ansible-check-b

trigger_a:
  stage: ansible-check-a
  trigger:
    include: a/.gitlab-ci.yml
  rules:
    - changes:
        - roles/a/*

trigger_b:
  stage: ansible-check-b
  trigger:
    include: b/.gitlab-ci.yml
  rules:
    - changes:
        - roles/b/*

ansible-check-a:
  stage: ansible-check-a
  tags:
    - ansible
  script:
    - ansible-playbook --check -i inventory.yml playbook-a.yml
  cache: []

ansible-check-b:
  stage: ansible-check-b
  tags:
    - ansible
  script:
    - ansible-playbook --check -i inventory.yml playbook-b.yml
  cache: []
